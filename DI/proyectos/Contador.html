<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contador Temático de Personas</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuración para usar la fuente Inter y personalizar colores -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    // Colores base
                    colors: {
                        'blue-primary': '#4F46E5',    
                        'night-bg': '#141E30',    
                        'night-card': '#1F2937',  
                        'day-bg': '#F3F4F6',      
                        'day-card': '#FFFFFF',    
                        'text-light': '#E5E7EB',  
                        'text-dark': '#1F2937',   
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Aplicar transiciones suaves a todos los elementos que cambian de color */
        .transition-theme {
            transition: all 0.5s ease-in-out;
        }

        /* Estilo base para el switch (fuera de Tailwind para el diseño específico) */
        .theme-switch {
            width: 70px;
            height: 34px;
            border-radius: 34px;
            position: relative;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            transition: background-color 0.5s;
        }

        .theme-switch .slider {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: transform 0.5s, background-color 0.5s;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* Posición del slider cuando está en modo Noche (checked) */
        .theme-switch.night .slider {
            transform: translateX(36px);
        }
        
        /* CLASE DE ANIMACIÓN DE FEEDBACK VISUAL */
        @keyframes pulse-once {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pop-feedback {
            animation: pulse-once 0.2s ease-out;
        }
        
        /* Estilo para el contenedor de alerta de aforo máximo */
        #max-capacity-alert {
            display: none;
            padding: 8px;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 10px;
            text-align: center;
            /* Animación suave para alertar al usuario */
            animation: shake 0.5s ease-in-out infinite alternate;
        }
        
        @keyframes shake {
            0% { transform: translateX(0); }
            50% { transform: translateX(-2px); }
            100% { transform: translateX(2px); }
        }
        
        /* Estilo para los inputs de cantidad inicial */
        .input-count-initial {
            font-size: 1.5rem; /* Más grande en móvil */
        }
        
        /* Ajuste de tamaño de fuente para el conteo total en móvil */
        @media (max-width: 768px) {
            #total-count {
                font-size: 5rem; /* Un poco más pequeño que 7xl para móvil */
            }
        }
    </style>
</head>

<!-- El modo por defecto es Noche, el tema es Principal, y el acento es Azul -->
<body id="app-body" class="transition-theme font-sans min-h-screen p-4 md:p-8">

    <div class="max-w-4xl mx-auto">
        <header id="app-header" class="flex justify-between items-center mb-6 md:mb-10 p-4 rounded-xl shadow-2xl transition-theme">
            <h1 id="app-title" class="text-2xl md:text-3xl font-extrabold tracking-tight transition-theme">
                Registro de Aforo
            </h1>
            
            <!-- Switch de Tema DÍA / NOCHE -->
            <div class="flex items-center space-x-2 md:space-x-3">
                <span id="theme-label" class="text-xs md:text-sm font-medium transition-theme">Noche</span>
                <div id="theme-toggle" class="theme-switch night" onclick="toggleTheme()">
                    <div id="theme-slider" class="slider"></div>
                </div>
            </div>
        </header>

        <!-- Contenedores de Contadores -->
        <!-- En móvil (sm), es una columna (grid-cols-1). En pantallas grandes (lg), son 3 columnas. -->
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            
            <!-- Contador Total -->
            <div id="total-card" class="lg:col-span-1 p-6 rounded-2xl shadow-xl transition-theme border-l-4">
                <div class="text-center">
                    <h2 class="text-xl font-semibold mb-4 transition-theme">Aforo Total</h2>
                    <p id="total-count" class="text-7xl font-bold transition-theme inline-block">0</p>
                    
                    <!-- Alerta de Aforo Máximo Alcanzado -->
                    <div id="max-capacity-alert" class="bg-red-200 text-red-800 transition-theme" style="display: none;">
                        ¡AFORO MÁXIMO ALCANZADO!
                    </div>
                    <!-- Indicador de Aforo Máximo -->
                    <p id="max-capacity-display" class="text-sm mt-2 transition-theme"></p>
                </div>
            </div>

            <!-- Contador Hombres -->
            <div id="men-card" class="p-6 rounded-2xl shadow-xl transition-theme border-l-4">
                <h2 class="text-xl font-semibold mb-4 text-center transition-theme">Hombres</h2>
                <div class="flex flex-col items-center">
                    <p id="men-count" class="text-6xl font-extrabold mb-4 transition-theme inline-block">0</p>
                    <!-- Botones de acción: se expanden en móvil y se mantienen juntos -->
                    <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 w-full justify-center">
                        <button id="men-add-btn" onclick="updateCount('men', 1)" class="action-btn transition-theme text-white py-3 px-6 rounded-xl font-bold flex-1 text-lg shadow-lg active:scale-95">
                            + Añadir
                        </button>
                        <button onclick="updateCount('men', -1)" class="action-btn transition-theme bg-red-600 hover:bg-red-700 text-white py-3 px-6 rounded-xl font-bold flex-1 text-lg shadow-lg active:scale-95 disabled:opacity-50" disabled>
                            - Restar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Contador Mujeres -->
            <div id="women-card" class="p-6 rounded-2xl shadow-xl transition-theme border-l-4">
                <h2 class="text-xl font-semibold mb-4 text-center transition-theme">Mujeres</h2>
                <div class="flex flex-col items-center">
                    <p id="women-count" class="text-6xl font-extrabold mb-4 transition-theme inline-block">0</p>
                    <!-- Botones de acción: se expanden en móvil y se mantienen juntos -->
                    <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 w-full justify-center">
                        <button id="women-add-btn" onclick="updateCount('women', 1)" class="action-btn transition-theme text-white py-3 px-6 rounded-xl font-bold flex-1 text-lg shadow-lg active:scale-95">
                            + Añadir
                        </button>
                        <button onclick="updateCount('women', -1)" class="action-btn transition-theme bg-red-600 hover:bg-red-700 text-white py-3 px-6 rounded-xl font-bold flex-1 text-lg shadow-lg active:scale-95 disabled:opacity-50" disabled>
                            - Restar
                        </button>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Sección para Iniciar Conteo con Número y Botón de Reset Combinados -->
        <section id="initial-setup" class="p-6 rounded-2xl shadow-xl transition-theme mb-8">
            <h3 class="text-xl font-semibold mb-4 transition-theme">
                ⚙️ Conteo Inicial y Reset
            </h3>
            
            <!-- AFORO MÁXIMO INPUT (Valor por defecto 0) -->
             <div class="flex flex-col mb-6">
                <label for="max-capacity" class="text-sm font-medium mb-1 transition-theme">
                    Aforo Máximo (0 = Ilimitado):
                </label>
                <!-- Ajuste del tamaño del input para el aforo máximo -->
                <input type="number" id="max-capacity" value="0" min="0" 
                       class="input-themed p-3 rounded-lg border-2 focus:ring-2 focus:border-transparent transition-theme shadow-inner text-2xl font-bold">
            </div>
            
            <!-- INPUTS Y BOTONES DE ACCIÓN EN UNA FILA -->
            <!-- Layout: 2 columnas en móvil, 4 columnas en tablet/desktop para alinear -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 items-end border-t pt-4 transition-theme">
                
                <!-- Input Hombres -->
                <div class="flex flex-col">
                    <label for="initial-men" class="text-sm font-medium mb-1 transition-theme">Hombres:</label>
                    <input type="number" id="initial-men" value="0" min="0" 
                           class="input-themed input-count-initial p-3 rounded-lg border-2 focus:ring-2 focus:border-transparent transition-theme shadow-inner">
                </div>
                
                <!-- Input Mujeres -->
                <div class="flex flex-col">
                    <label for="initial-women" class="text-sm font-medium mb-1 transition-theme">Mujeres:</label>
                    <input type="number" id="initial-women" value="0" min="0" 
                           class="input-themed input-count-initial p-3 rounded-lg border-2 focus:ring-2 focus:border-transparent transition-theme shadow-inner">
                </div>

                <!-- Botón Aplicar Conteo (Ocupa el espacio restante en móvil si los inputs no tienen el ancho completo) -->
                <!-- El mt-4 es para asegurar espacio en móvil si los inputs estuvieran apilados -->
                <button onclick="setInitialCount()" 
                        class="action-btn transition-theme bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-bold text-lg shadow-lg active:scale-95 col-span-2 md:col-span-1 md:mt-0 mt-4">
                    🚀 Aplicar Conteo
                </button>
                
                <!-- Botón Reset -->
                <button onclick="resetAll()" 
                        class="transition-theme bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 rounded-xl text-lg shadow-xl hover:shadow-2xl active:scale-95 col-span-2 md:col-span-1 md:mt-0 mt-4">
                    🗑️ Eliminar Todo (Reset)
                </button>
            </div>
            
        </section>
        
        <!-- SECCIÓN 1: OPCIONES VISUALES (TEMA Y ACENTO) -->
        <section id="visual-options-panel" class="p-6 rounded-2xl shadow-xl transition-theme mb-6">
            <div class="flex justify-between items-center cursor-pointer" onclick="toggleVisualOptions()">
                <h3 id="visual-options-title" class="text-xl font-semibold transition-theme">
                    🎨 Opciones de Estilo y Tema
                </h3>
                <!-- Flecha de despliegue con animación -->
                <span id="visual-options-arrow" class="text-2xl transition-transform duration-500 transform">▼</span>
            </div>
            
            <!-- Contenido Desplegable (Inicialmente colapsado por JS) -->
            <div id="visual-options-content" class="mt-4 transition-all duration-500 overflow-hidden">
                
                <!-- 1. Selección de Fondo y Apariencia (Tema Principal) -->
                <div class="pt-2 border-b border-gray-200 pb-4 mb-4">
                    <p class="mb-3 text-sm transition-theme font-bold">Fondo y Apariencia (Tema Principal):</p>
                    <!-- Layout: 2 columnas en móvil, 3 en desktop -->
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <!-- Tema Principal (Gris / Azul) -->
                        <label class="theme-label flex items-center space-x-2 p-3 rounded-lg border-2 border-transparent cursor-pointer transition-theme" for="theme-primary">
                            <input type="radio" id="theme-primary" name="app_theme" value="primary" checked onchange="setTheme('primary')" class="form-radio h-5 w-5 text-blue-500">
                            <span class="font-medium">Principal (Gris)</span>
                        </label>
                        
                        <!-- Tema Océano (Cian / Azul) -->
                        <label class="theme-label flex items-center space-x-2 p-3 rounded-lg border-2 border-transparent cursor-pointer transition-theme" for="theme-ocean">
                            <input type="radio" id="theme-ocean" name="app_theme" value="ocean" onchange="setTheme('ocean')" class="form-radio h-5 w-5 text-blue-500">
                            <span class="font-medium">Océano (Azul Claro)</span>
                        </label>

                        <!-- Tema Bosque (Verde) -->
                        <label class="theme-label flex items-center space-x-2 p-3 rounded-lg border-2 border-transparent cursor-pointer transition-theme" for="theme-forest">
                            <input type="radio" id="theme-forest" name="app_theme" value="forest" onchange="setTheme('forest')" class="form-radio h-5 w-5 text-blue-500">
                            <span class="font-medium">Bosque (Verdoso)</span>
                        </label>
                        
                        <!-- Tema Lavanda -->
                        <label class="theme-label flex items-center space-x-2 p-3 rounded-lg border-2 border-transparent cursor-pointer transition-theme" for="theme-lavender">
                            <input type="radio" id="theme-lavender" name="app_theme" value="lavender" onchange="setTheme('lavender')" class="form-radio h-5 w-5 text-blue-500">
                            <span class="font-medium">Lavanda (Morado)</span>
                        </label>

                        <!-- Tema Carbono -->
                        <label class="theme-label flex items-center space-x-2 p-3 rounded-lg border-2 border-transparent cursor-pointer transition-theme" for="theme-carbon">
                            <input type="radio" id="theme-carbon" name="app_theme" value="carbon" onchange="setTheme('carbon')" class="form-radio h-5 w-5 text-blue-500">
                            <span class="font-medium">Carbono (Negro)</span>
                        </label>

                        <!-- Tema Fuego -->
                        <label class="theme-label flex items-center space-x-2 p-3 rounded-lg border-2 border-transparent cursor-pointer transition-theme" for="theme-fire">
                            <input type="radio" id="theme-fire" name="app_theme" value="fire" onchange="setTheme('fire')" class="form-radio h-5 w-5 text-blue-500">
                            <span class="font-medium">Fuego (Naranja)</span>
                        </label>
                    </div>
                </div>

                <!-- 2. Selección de Color de Acento Principal (Highlights) -->
                <div class="pt-2">
                    <p class="mb-3 text-sm transition-theme font-bold">Color de Acento (Botones, Títulos, Bordes):</p>
                    <div class="flex flex-wrap gap-4">
                        <!-- Acento Azul -->
                        <label class="accent-label flex items-center space-x-2 p-3 rounded-lg border-2 border-transparent cursor-pointer transition-theme" for="accent-blue">
                            <input type="radio" id="accent-blue" name="app_accent" value="blue" checked onchange="setAccent('blue')" class="form-radio h-5 w-5 text-blue-500">
                            <span class="font-medium text-blue-500">Azul</span>
                        </label>
                        
                        <!-- Acento Cian -->
                        <label class="accent-label flex items-center space-x-2 p-3 rounded-lg border-2 border-transparent cursor-pointer transition-theme" for="accent-cyan">
                            <input type="radio" id="accent-cyan" name="app_accent" value="cyan" onchange="setAccent('cyan')" class="form-radio h-5 w-5 text-cyan-500">
                            <span class="font-medium text-cyan-500">Cian</span>
                        </label>

                        <!-- Acento Esmeralda -->
                        <label class="accent-label flex items-center space-x-2 p-3 rounded-lg border-2 border-transparent cursor-pointer transition-theme" for="accent-emerald">
                            <input type="radio" id="accent-emerald" name="app_accent" value="emerald" onchange="setAccent('emerald')" class="form-radio h-5 w-5 text-emerald-500">
                            <span class="font-medium text-emerald-500">Esmeralda</span>
                        </label>
                        
                        <!-- Acento Púrpura -->
                        <label class="accent-label flex items-center space-x-2 p-3 rounded-lg border-2 border-transparent cursor-pointer transition-theme" for="accent-purple">
                            <input type="radio" id="accent-purple" name="app_accent" value="purple" onchange="setAccent('purple')" class="form-radio h-5 w-5 text-purple-500">
                            <span class="font-medium text-purple-500">Púrpura</span>
                        </label>
                        
                        <!-- Acento Rojo -->
                        <label class="accent-label flex items-center space-x-2 p-3 rounded-lg border-2 border-transparent cursor-pointer transition-theme" for="accent-red">
                            <input type="radio" id="accent-red" name="app_accent" value="red" onchange="setAccent('red')" class="form-radio h-5 w-5 text-red-500">
                            <span class="font-medium text-red-500">Rojo</span>
                        </label>
                    </div>
                </div>
            </div>
        </section>


        <!-- SECCIÓN 2: CONFIGURACIÓN DE PASOS DE CONTEO -->
        <section id="counter-steps-panel" class="p-6 rounded-2xl shadow-xl transition-theme mb-8">
            <div class="flex justify-between items-center cursor-pointer" onclick="toggleCounterSteps()">
                <h3 id="counter-steps-title" class="text-xl font-semibold transition-theme">
                    🔧 Configuración de Pasos de Conteo (+<span id="current-increment">1</span> / -<span id="current-decrement">1</span>)
                </h3>
                <!-- Flecha de despliegue con animación -->
                <span id="counter-steps-arrow" class="text-2xl transition-transform duration-500 transform">▼</span>
            </div>
            
            <!-- Contenido Desplegable (Inicialmente colapsado por JS) -->
            <div id="counter-steps-content" class="mt-4 transition-all duration-500 overflow-hidden">
                
                <!-- 2. Paso de Incremento -->
                <p class="mb-3 text-sm transition-theme font-bold pt-2">Paso de Incremento (+ Añadir):</p>
                <div class="flex flex-wrap gap-4 mb-6">
                    <!-- Radio Button 1 -->
                    <label class="step-label flex items-center space-x-2 p-3 rounded-lg border-2 border-transparent cursor-pointer transition-theme" for="step-1">
                        <input type="radio" id="step-1" name="increment_step" value="1" checked onchange="setIncrementStep(1)" class="form-radio h-5 w-5 text-blue-500">
                        <span class="font-medium">1 en 1</span>
                    </label>
                    
                    <!-- Radio Button 5 -->
                    <label class="step-label flex items-center space-x-2 p-3 rounded-lg border-2 border-transparent cursor-pointer transition-theme" for="step-5">
                        <input type="radio" id="step-5" name="increment_step" value="5" onchange="setIncrementStep(5)" class="form-radio h-5 w-5 text-blue-500">
                        <span class="font-medium">5 en 5</span>
                    </label>

                    <!-- Radio Button 10 -->
                    <label class="step-label flex items-center space-x-2 p-3 rounded-lg border-2 border-transparent cursor-pointer transition-theme" for="step-10">
                        <input type="radio" id="step-10" name="increment_step" value="10" onchange="setIncrementStep(10)" class="form-radio h-5 w-5 text-blue-500">
                        <span class="font-medium">10 en 10</span>
                    </label>
                </div>

                <!-- 3. Paso de Decremento -->
                <p class="mb-3 text-sm transition-theme font-bold">Paso de Decremento (- Restar):</p>
                <div class="flex flex-wrap gap-4 mb-4">
                    <!-- Radio Button -1 -->
                    <label class="step-label flex items-center space-x-2 p-3 rounded-lg border-2 border-transparent cursor-pointer transition-theme" for="step-dec-1">
                        <input type="radio" id="step-dec-1" name="decrement_step" value="1" checked onchange="setDecrementStep(1)" class="form-radio h-5 w-5 text-blue-500">
                        <span class="font-medium">1 en 1</span>
                    </label>
                    
                    <!-- Radio Button -5 -->
                    <label class="step-label flex items-center space-x-2 p-3 rounded-lg border-2 border-transparent cursor-pointer transition-theme" for="step-dec-5">
                        <input type="radio" id="step-dec-5" name="decrement_step" value="5" onchange="setDecrementStep(5)" class="form-radio h-5 w-5 text-blue-500">
                        <span class="font-medium">5 en 5</span>
                    </label>

                    <!-- Radio Button -10 -->
                    <label class="step-label flex items-center space-x-2 p-3 rounded-lg border-2 border-transparent cursor-pointer transition-theme" for="step-dec-10">
                        <input type="radio" id="step-dec-10" name="decrement_step" value="10" onchange="setDecrementStep(10)" class="form-radio h-5 w-5 text-blue-500">
                        <span class="font-medium">10 en 10</span>
                    </label>
                </div>


                <!-- Botón de Reset de Configuración -->
                <button onclick="resetIncrement()" class="transition-theme bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg active:scale-95 text-sm">
                    🔄 Valores por Defecto (+1 / -1)
                </button>
            </div>
        </section>
        
    </div>

    <script>
        // --- Definición de Temas (solo fondos y texto principal) ---
        const themes = {
            'primary': {
                bg: { day: 'bg-gray-100', night: 'bg-night-bg' },
                card: { day: 'bg-white', night: 'bg-night-card' },
                text: { day: 'text-text-dark', night: 'text-text-light' },
                dayStepBg: 'bg-gray-200', 
                dayInputBg: 'bg-white',
                nightStepBg: 'bg-gray-800',
                nightInputBg: 'bg-gray-800',
            },
            'ocean': {
                bg: { day: 'bg-sky-50', night: 'bg-gray-900' },
                card: { day: 'bg-white', night: 'bg-gray-800' },
                text: { day: 'text-gray-900', night: 'text-gray-100' },
                dayStepBg: 'bg-sky-100',
                dayInputBg: 'bg-white',
                nightStepBg: 'bg-gray-700',
                nightInputBg: 'bg-gray-700',
            },
            'forest': {
                bg: { day: 'bg-green-50', night: 'bg-gray-900' },
                card: { day: 'bg-white', night: 'bg-gray-800' },
                text: { day: 'text-gray-900', night: 'text-gray-100' },
                dayStepBg: 'bg-green-100',
                dayInputBg: 'bg-white',
                nightStepBg: 'bg-gray-700',
                nightInputBg: 'bg-gray-700',
            },
            // Temas Lavanda y Fuego ajustados para menor saturación en noche
            'lavender': {
                bg: { day: 'bg-purple-50', night: 'bg-zinc-900' }, 
                card: { day: 'bg-white', night: 'bg-zinc-800' },   
                text: { day: 'text-gray-900', night: 'text-gray-100' },
                dayStepBg: 'bg-purple-100',
                dayInputBg: 'bg-white',
                nightStepBg: 'bg-zinc-700',
                nightInputBg: 'bg-zinc-700',
            },
            'carbon': {
                bg: { day: 'bg-gray-900', night: 'bg-black' },
                card: { day: 'bg-gray-800', night: 'bg-gray-900' },
                text: { day: 'text-gray-100', night: 'text-gray-200' },
                dayStepBg: 'bg-gray-700',
                dayInputBg: 'bg-gray-700',
                nightStepBg: 'bg-gray-800',
                nightInputBg: 'bg-gray-800',
            },
            'fire': {
                bg: { day: 'bg-orange-50', night: 'bg-stone-900' }, 
                card: { day: 'bg-white', night: 'bg-stone-800' },   
                text: { day: 'text-gray-900', night: 'text-gray-100' },
                dayStepBg: 'bg-orange-100',
                dayInputBg: 'bg-white',
                nightStepBg: 'bg-stone-700',
                nightInputBg: 'bg-stone-700',
            }
        };

        // --- Definición de Acentos (colores para botones, títulos, bordes) ---
        const ACCENTS = {
            'blue': { 
                btn: 'bg-blue-600 hover:bg-blue-700', 
                border: 'border-blue-500', 
                text: 'text-blue-500', 
                radio: 'text-blue-500', 
                sliderNight: 'bg-blue-500' 
            },
            'cyan': { 
                btn: 'bg-cyan-600 hover:bg-cyan-700', 
                border: 'border-cyan-500', 
                text: 'text-cyan-500', 
                radio: 'text-cyan-500',
                sliderNight: 'bg-cyan-500' 
            },
            'emerald': { 
                btn: 'bg-emerald-600 hover:bg-emerald-700', 
                border: 'border-emerald-500', 
                text: 'text-emerald-500', 
                radio: 'text-emerald-500',
                sliderNight: 'bg-emerald-500'
            },
            'red': { 
                btn: 'bg-red-600 hover:bg-red-700', 
                border: 'border-red-500', 
                text: 'text-red-500', 
                radio: 'text-red-500',
                sliderNight: 'bg-red-500'
            },
            'purple': { 
                btn: 'bg-purple-600 hover:bg-purple-700', 
                border: 'border-purple-500', 
                text: 'text-purple-500', 
                radio: 'text-purple-500',
                sliderNight: 'bg-purple-500'
            },
        };

        // --- Constantes de Configuración ---
        const HIGH_OCCUPANCY_THRESHOLD = 25; // El total de aforo cambia de color a partir de este número
        const WARNING_COLOR_CLASS = 'text-orange-500'; // Color de advertencia para aforo alto

        // --- Lógica del Contador ---
        let men = 0;
        let women = 0;
        let total = 0;
        let maxCapacity = 0; // Límite de aforo máximo, 0 = Ilimitado
        let isNightMode = true; 
        let currentTheme = 'primary'; 
        let currentAccentColorName = 'blue'; 
        let incrementStep = 1; 
        let decrementStep = 1;

        // Elementos del DOM 
        const totalEl = document.getElementById('total-count');
        const menEl = document.getElementById('men-count');
        const womenEl = document.getElementById('women-count');
        const themeToggle = document.getElementById('theme-toggle');
        const themeSlider = document.getElementById('theme-slider');
        const themeLabel = document.getElementById('theme-label');
        const body = document.getElementById('app-body');
        const cards = ['total-card', 'men-card', 'women-card'].map(id => document.getElementById(id));
        const initialSetupSection = document.getElementById('initial-setup');
        const counterStepsPanel = document.getElementById('counter-steps-panel');
        const counterStepsContent = document.getElementById('counter-steps-content');
        const counterStepsArrow = document.getElementById('counter-steps-arrow');
        const visualOptionsPanel = document.getElementById('visual-options-panel');
        const visualOptionsContent = document.getElementById('visual-options-content');
        const visualOptionsArrow = document.getElementById('visual-options-arrow');
        const currentIncrementEl = document.getElementById('current-increment');
        const currentDecrementEl = document.getElementById('current-decrement');
        const inputs = document.querySelectorAll('.input-themed');
        const actionBtns = document.querySelectorAll('.action-btn');
        const allThemedContainers = [...cards, initialSetupSection, counterStepsPanel, visualOptionsPanel];
        const initialMenInput = document.getElementById('initial-men');
        const initialWomenInput = document.getElementById('initial-women');
        const maxCapacityInput = document.getElementById('max-capacity'); 
        const maxCapacityAlert = document.getElementById('max-capacity-alert'); 
        const maxCapacityDisplay = document.getElementById('max-capacity-display'); 
        const menAddBtn = document.getElementById('men-add-btn'); 
        const womenAddBtn = document.getElementById('women-add-btn'); 

        // Función auxiliar para eliminar todas las clases que comienzan con un prefijo dado
        function removeClassPrefixes(element, prefixes) {
            if (!element) return;
            element.className = element.className.split(' ').filter(c => 
                !prefixes.some(prefix => c.startsWith(prefix + '-'))
            ).join(' ');
        }
        
        // Ejecuta la animación de "pop" en un elemento
        function animatePop(element) {
            element.classList.remove('pop-feedback');
            // Forzar reflow para reiniciar la animación
            void element.offsetWidth; 
            element.classList.add('pop-feedback');
        }

        // Actualiza el texto de los contadores y el estado de los botones de resta
        function renderCounts(triggerElementId = null) {
            total = men + women;
            totalEl.textContent = total;
            menEl.textContent = men;
            womenEl.textContent = women;

            // 1. Lógica de Aforo Máximo y Deshabilitar Botones
            // El aforo está lleno solo si maxCapacity es > 0 Y el total ha alcanzado o superado ese límite
            const isFull = maxCapacity > 0 && total >= maxCapacity;
            
            // Habilitar/Deshabilitar botones de suma/resta
            menAddBtn.disabled = isFull;
            womenAddBtn.disabled = isFull;
            
            // Los botones de resta se inhabilitan si el contador es 0 o si al restar se pasa de 0
            document.querySelector('#men-card button:nth-child(2)').disabled = men - decrementStep < 0;
            document.querySelector('#women-card button:nth-child(2)').disabled = women - decrementStep < 0;

            // Mostrar/Ocultar Alerta de Aforo Máximo
            maxCapacityAlert.style.display = isFull ? 'block' : 'none';
            
            // Actualizar display de aforo
            if (maxCapacity > 0) {
                 maxCapacityDisplay.textContent = `Máximo Permitido: ${maxCapacity}`;
            } else {
                 maxCapacityDisplay.textContent = 'Máximo Permitido: Ilimitado';
            }


            // 2. Lógica de Retroalimentación Visual (Animación)
            if (triggerElementId) {
                // Animar el contador específico y el contador total
                const specificEl = document.getElementById(triggerElementId);
                if (specificEl) animatePop(specificEl);
                animatePop(totalEl);
            }
            
            // 3. Lógica de Color del Aforo Total (Umbral)
            // Todas las clases de color que podrían estar aplicadas dinámicamente
            const allAccentColorClasses = [
                'text-blue-500', 'text-cyan-500', 'text-emerald-500', 'text-red-500', 'text-purple-500',
                'text-red-600', WARNING_COLOR_CLASS
            ];
            
            const accentText = ACCENTS[currentAccentColorName].text;
            const errorText = isNightMode ? 'text-red-500' : 'text-red-600';
            const fullCapacityText = 'text-red-600'; // Color de alarma cuando está lleno

            
            const countElements = [totalEl, menEl, womenEl];
            
            countElements.forEach(el => {
                // 1. Limpiar clases de color
                el.classList.remove(...allAccentColorClasses);

                if (el.id === 'total-count') {
                    if (isFull) {
                        // Si el aforo está lleno, usar color de alarma
                        el.classList.add(fullCapacityText);
                    } 
                    // Si el total está por encima del umbral (pero no lleno), usar el color de advertencia
                    else if (total >= HIGH_OCCUPANCY_THRESHOLD) {
                        el.classList.add(WARNING_COLOR_CLASS);
                    } 
                    // Si el total es 0, usar el color de error
                    else if (total === 0) {
                        el.classList.add(errorText);
                    }
                    // Si el total está entre 1 y el umbral, usar el color de acento
                    else {
                        el.classList.add(accentText);
                    }
                } else {
                    // Contadores individuales: usar el color de acento (a menos que sean cero)
                    if (parseInt(el.textContent) === 0) {
                         el.classList.add(errorText);
                    } else {
                         el.classList.add(accentText);
                    }
                }
            });
        }
        
        // --- Lógica de Tema y Acento (sin cambios funcionales) ---
        
        function setTheme(themeName) {
            currentTheme = themeName;
            applyThemeClasses(isNightMode, currentTheme, currentAccentColorName); 
        }
        
        function setAccent(accentName) {
            currentAccentColorName = accentName;
            applyThemeClasses(isNightMode, currentTheme, currentAccentColorName);
        }

        // Función para aplicar clases del tema y acento (Combinada)
        function applyThemeClasses(isNight, themeName, accentName) {
            isNightMode = isNight;
            const theme = themes[themeName];
            const accent = ACCENTS[accentName];
            const mode = isNight ? 'night' : 'day';

            // Prefijos de clases a limpiar (bg, border, focus:ring, hover:bg)
            const prefixes = ['bg', 'border', 'focus:ring', 'hover:bg'];

            // 1. Cuerpo de la app (Background y Texto principal)
            removeClassPrefixes(body, ['bg', 'text']); 
            body.classList.add(theme.bg[mode], theme.text[mode]);
            
            // 2. Header, Cards, Setup, Options (Card Backgrounds, Bordes y Títulos)
            removeClassPrefixes(document.getElementById('app-header'), prefixes);
            document.getElementById('app-header').classList.add(theme.card[mode]);

            allThemedContainers.forEach(container => {
                removeClassPrefixes(container, prefixes);
                container.classList.add(theme.card[mode]);
                
                // Bordes de tarjetas (usar el acento)
                if (container.id.includes('card')) {
                    removeClassPrefixes(container, ['border']);
                    container.classList.add('border-l-4', accent.border);
                }

                // Textos generales (h2, h3, label, etc.)
                const textElements = container.querySelectorAll('h2, h3, label, p, span:not(.slider)'); 
                textElements.forEach(el => {
                    // Excluir los elementos de conteo principales y la alerta de capacidad máxima
                    if (['total-count', 'men-count', 'women-count', 'max-capacity-alert'].includes(el.id)) {
                        return; 
                    }
                    
                    removeClassPrefixes(el, ['text']); 
                    el.classList.add(theme.text[mode]); 
                });
            });
            
            // Textos específicos que usan el color de acento (títulos de secciones, flechas)
            const accentTextElements = [
                document.getElementById('app-title'),
                document.getElementById('total-card').querySelector('h2'),
                document.getElementById('counter-steps-arrow'),
                document.getElementById('visual-options-arrow')
            ];
            accentTextElements.forEach(el => {
                removeClassPrefixes(el, ['text']);
                el.classList.add(accent.text);
            });


            // 3. Inputs (Setup Section)
            inputs.forEach(input => {
                removeClassPrefixes(input, prefixes);
                const ringColor = 'focus:ring-' + accentName + '-500'; 
                const inputBg = isNight ? theme.nightInputBg : theme.dayInputBg;
                
                input.classList.add(accent.border, ringColor, inputBg);
                
                const inputTextColor = isNight ? 'text-white' : 'text-gray-900';
                removeClassPrefixes(input, ['text']);
                input.classList.add(inputTextColor);
            });

            // 4. Botones de Adición (usar el acento)
            actionBtns.forEach((btn, index) => {
                // El índice 0 y 2 son los botones de Añadir (+), y el 3 es Aplicar Conteo
                const isAddButton = btn.id === 'men-add-btn' || btn.id === 'women-add-btn' || btn.textContent.includes('Aplicar Conteo');
                
                if (isAddButton) { 
                    removeClassPrefixes(btn, ['bg', 'hover:bg']);
                    btn.classList.add(...accent.btn.split(' ')); 
                }
            });
            
            // El botón de Reset (Eliminar Todo) usa un color gris fijo, aseguramos texto blanco para legibilidad
            document.querySelector('#initial-setup button:last-child').classList.add('text-white');

            // 5. Labels de Radio Button (Paso e Acento)
            const stepLabelColor = isNight ? theme.nightStepBg : theme.dayStepBg;
            
            document.querySelectorAll('.step-label, .theme-label, .accent-label').forEach(label => {
                removeClassPrefixes(label, ['bg', 'border']);
                label.classList.add(stepLabelColor);
                
                // Aplicar color de acento al radio button (punto)
                const radioInput = label.querySelector('input[type="radio"]');
                removeClassPrefixes(radioInput, ['text']);
                radioInput.classList.add(accent.radio);
                
                // Aplicar borde de acento al label seleccionado
                if (radioInput.checked) {
                     removeClassPrefixes(label, ['border']);
                     label.classList.add(accent.border);
                } else {
                     label.classList.add('border-transparent');
                }
                
                // Asegurar que el texto del span es del color de texto principal
                const innerSpan = label.querySelector('span');
                removeClassPrefixes(innerSpan, ['text']);
                innerSpan.classList.add(theme.text[mode]);
            });

            // 6. Switch
            themeToggle.classList.remove(isNight ? 'day' : 'night');
            themeToggle.classList.add(isNight ? 'night' : 'day');
            
            removeClassPrefixes(themeToggle, ['bg']);
            themeToggle.classList.add(isNight ? 'bg-gray-700' : 'bg-gray-200');

            // Color del slider para que coincida con el acento del tema en modo noche
            if (isNight) {
                removeClassPrefixes(themeSlider, ['bg']);
                themeSlider.classList.add(accent.sliderNight);
                themeSlider.classList.remove('bg-white');
            } else {
                removeClassPrefixes(themeSlider, ['bg']);
                themeSlider.classList.add('bg-white');
            }

            // 7. Etiqueta del tema
            themeLabel.textContent = isNight ? 'Noche' : 'Día';
            
            renderCounts(); 
        }

        // Función para alternar el tema al hacer clic en el switch
        function toggleTheme() {
            applyThemeClasses(!isNightMode, currentTheme, currentAccentColorName);
        }
        
        // --- Lógica de Pasos de Conteo y Conteo Principal ---

        // Función principal para sumar o restar
        function updateCount(gender, sign) {
            const step = sign > 0 ? incrementStep : decrementStep;
            const value = sign * step; 
            let triggerId = '';
            
            if (gender === 'men') {
                // Comprobar límite si se intenta sumar
                if (sign > 0 && maxCapacity > 0 && total + value > maxCapacity) {
                    // Si se excede, establecer al máximo si no estaba lleno
                    if (total < maxCapacity) {
                         men += (maxCapacity - total);
                         triggerId = 'men-count';
                    }
                } else if (men + value >= 0) {
                    men += value;
                    triggerId = 'men-count';
                } else if (men > 0 && men + value < 0) {
                    men = 0;
                    triggerId = 'men-count';
                }
            } else if (gender === 'women') {
                 // Comprobar límite si se intenta sumar
                 if (sign > 0 && maxCapacity > 0 && total + value > maxCapacity) {
                    // Si se excede, establecer al máximo si no estaba lleno
                    if (total < maxCapacity) {
                         women += (maxCapacity - total);
                         triggerId = 'women-count';
                    }
                } else if (women + value >= 0) {
                    women += value;
                    triggerId = 'women-count';
                } else if (women > 0 && women + value < 0) {
                    women = 0;
                    triggerId = 'women-count';
                }
            }
            // Pasar el ID del elemento que activó el cambio para la animación
            renderCounts(triggerId); 
        }
        
        // Función para cambiar el valor de incremento
        function setIncrementStep(value) {
            incrementStep = value;
            currentIncrementEl.textContent = value;
            applyThemeClasses(isNightMode, currentTheme, currentAccentColorName);
        }

        // Función para cambiar el valor de decremento
        function setDecrementStep(value) {
            decrementStep = value;
            currentDecrementEl.textContent = value;
            // Al cambiar el decremento, debemos re-evaluar si los botones de resta deben estar habilitados/deshabilitados
            renderCounts(); 
            applyThemeClasses(isNightMode, currentTheme, currentAccentColorName);
        }

        // Función para resetear el valor de incremento/decremento a 1
        function resetIncrement() {
            setIncrementStep(1);
            setDecrementStep(1);
            document.getElementById('step-1').checked = true;
            document.getElementById('step-dec-1').checked = true;
            applyThemeClasses(isNightMode, currentTheme, currentAccentColorName);
        }
        
        // Función para alternar la visibilidad del panel de Pasos de Conteo
        function toggleCounterSteps() {
            const isCollapsed = counterStepsContent.style.maxHeight === '0px' || counterStepsContent.style.maxHeight === '';
            
            if (isCollapsed) {
                // Ajustar al alto real del contenido + un poco de margen para asegurar la visibilidad
                counterStepsContent.style.maxHeight = (counterStepsContent.scrollHeight + 50) + "px"; 
                counterStepsArrow.classList.add('rotate-180');
            } else {
                counterStepsContent.style.maxHeight = "0px";
                counterStepsArrow.classList.remove('rotate-180');
            }
        }
        
        // Función para alternar la visibilidad del panel de Opciones Visuales
        function toggleVisualOptions() {
            const isCollapsed = visualOptionsContent.style.maxHeight === '0px' || visualOptionsContent.style.maxHeight === '';
            
            if (isCollapsed) {
                // Ajustar al alto real del contenido + un poco de margen para asegurar la visibilidad
                visualOptionsContent.style.maxHeight = (visualOptionsContent.scrollHeight + 50) + "px"; 
                visualOptionsArrow.classList.add('rotate-180');
            } else {
                visualOptionsContent.style.maxHeight = "0px";
                visualOptionsArrow.classList.remove('rotate-180');
            }
        }

        // Función para establecer el conteo inicial basado en los inputs del usuario
        function setInitialCount() {
            let newMax = parseInt(maxCapacityInput.value, 10);
            if (isNaN(newMax) || newMax < 0) { newMax = 0; }
            maxCapacity = newMax;
            
            let newMen = parseInt(initialMenInput.value, 10);
            if (isNaN(newMen) || newMen < 0) { newMen = 0; }

            let newWomen = parseInt(initialWomenInput.value, 10);
            if (isNaN(newWomen) || newWomen < 0) { newWomen = 0; }
            
            let newTotal = newMen + newWomen;
            
            // Si el total inicial excede el máximo, ajustarlo
            if (maxCapacity > 0 && newTotal > maxCapacity) {
                // Si el total excede el máximo, ajustamos las mujeres (o el que sea más pequeño) para que el total sea maxCapacity
                if (newWomen > newTotal - maxCapacity) {
                    newWomen = maxCapacity - newMen;
                } else {
                    newMen = maxCapacity - newWomen;
                }
                newTotal = newMen + newWomen; // Recalcular total
            }
            
            // Si después del ajuste el total sigue excediendo (por un error en la lógica simple de arriba, aunque no debería)
            // se ajusta el total para que sea exactamente el máximo si es positivo.
            if (maxCapacity > 0 && newTotal > maxCapacity) {
                 newTotal = maxCapacity;
                 // Re-distribuir de forma simple manteniendo la proporción (si es posible)
                 newMen = Math.floor(newTotal / 2);
                 newWomen = newTotal - newMen;
            }

            men = newMen;
            women = newWomen;
            
            // Pasar un ID nulo para no activar la animación en la configuración inicial
            renderCounts(); 
            
            // Asegurar que los inputs reflejan los valores finales (ajustados si exceden el máximo)
            initialMenInput.value = men;
            initialWomenInput.value = women;
            maxCapacityInput.value = maxCapacity;
        }

        // Función para poner todos los contadores a 0 (mantiene la configuración de pasos y tema)
        function resetAll() {
            men = 0;
            women = 0;
            maxCapacity = 0; // Reseteamos el máximo al valor por defecto (Ilimitado)
            initialMenInput.value = 0; 
            initialWomenInput.value = 0;
            maxCapacityInput.value = 0;
            renderCounts();
        }

        // Event listener para el cambio en el Aforo Máximo (actualiza en tiempo real)
        maxCapacityInput.addEventListener('input', () => {
             let newMax = parseInt(maxCapacityInput.value, 10);
             if (isNaN(newMax) || newMax < 0) { newMax = 0; }
             maxCapacity = newMax;
             renderCounts(); // Llama a renderCounts para aplicar la lógica de límite inmediatamente
        });

        // Event listeners para los cambios en los inputs iniciales (para aplicar límites en tiempo real)
        initialMenInput.addEventListener('input', setInitialCount);
        initialWomenInput.addEventListener('input', setInitialCount);


        // Inicialización
        document.addEventListener('DOMContentLoaded', () => {
            // Aplicar el tema inicial (Noche, Principal, Azul) al cargar
            applyThemeClasses(true, 'primary', 'blue'); 
            
            // Inicializar ambos paneles de opciones como colapsados
            counterStepsContent.style.maxHeight = "0px";
            counterStepsArrow.classList.remove('rotate-180');
            
            visualOptionsContent.style.maxHeight = "0px";
            visualOptionsArrow.classList.remove('rotate-180');
            
            // Asegurar que el display de máximo se muestre correctamente al inicio
            renderCounts();
        });

    </script>
</body>
</html>